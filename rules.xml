<?xml version="1.0" encoding="UTF-8"?>
<ruleset>
<server-settings>
  <!-- server>localhost:8906</server-->
  <server>localhost:8880</server>
  <execute-pyref>false</execute-pyref>
  <dev-allow>localhost</dev-allow>
  <dev-user username="admin" password="admin" />
  <display-local-files>false</display-local-files>
  <edit-local-files>false</edit-local-files>
</server-settings>

<proxy keep-host="1" path="/static" class="static">
  <dest href="{here}" />
</proxy>

<!--
  tagesansicht
  wochenansicht
  sendungen
  sendungsmachende
  programmhinweise
  programmschienen
  programmflyer
-->
<!-- TODO: rewrite rules for nginx to force trailing slash on program urls -->
<proxy path="/programm/tagesansicht" class="program">
  <dest href="http://localhost:8000/program" />
  <response rewrite-links="1" />
</proxy>
<proxy path="/programm/wochenansicht" class="program">
  <dest href="http://localhost:8000/program" />
  <response rewrite-links="1" />
</proxy>
<proxy path="/programm/sendungen" class="program">
  <dest href="http://localhost:8000/program/shows" />
  <response rewrite-links="1" />
</proxy>
<proxy path="/programm/sendungsmacherinnen" class="program">
  <dest href="http://localhost:8000/program/hosts" />
  <response rewrite-links="1" />
</proxy>
<proxy path="/programm/tipps" class="program">
  <dest href="http://localhost:8000/program/recommendations" />
  <response rewrite-links="1" />
</proxy>
<proxy path="/programm/tipps_portlet" class="program">
  <dest href="http://localhost:8000/program/recommendations_box" />
  <response rewrite-links="1" />
</proxy>


<!-- proxy path="/" class="common plone">
  <dest href="http://localhost:8106/VirtualHostBase/http/helsinki.adm.at:80/radio-helsinki/helsinki/VirtualHostRoot/" />
</proxy -->
<proxy path="/" class="common plone">
  <dest href="http://localhost:8080/VirtualHostBase/http/localhost:8880/radio-helsinki/helsinki/VirtualHostRoot/" />
</proxy>

<!-- plone popups -->
<match path="regex:.*contenthistorypopup.*" abort="1" />
<!-- TinyMCE -->
<match path="regex:^/portal_javascripts/.*" abort="1" />
<match path="regex:.*/themes/advanced/.*" abort="1" />
<match path="regex:.*/plugins/.*" abort="1" /> 
<match path="regex:.*/image_view_fullscreen$" abort="1" /> 


<rule class="program" suppress-standard="1">
  <!-- rename plone paths to those of django. unify paths. show, shows -> shows -->
  <theme href="http://localhost:8880/programm/" />
  <append href="/programm/tipps_portlet/"
    content="children:body"
    theme="children:#column-1" />
  <replace content="children:body" theme="children:#content-main" />
</rule>


<rule class="common" suppress-standard="1">
  <theme href="/static/index.html" />

  <drop theme="/html/head/meta"/>

  <replace content="/html/head/title" theme="/html/head/title"/>
  <append content="/html/head/base" theme="children:/html/head"/>
  <append content="/html/head/meta" theme="children:/html/head"/>
  <append content="link[rel *= 'kss-base-url']" theme="children:/html/head"/>

  <!-- workaround jscalendar/calendar-system.css bug
       see: http://blog.jazkarta.com/2010/04/02/deliverance-great-plone-theming-no-zope-after-taste/ -->
  <drop content="style[media = 'all']"/>
  <drop
    if-content="not:body.template-atct_edit"
    theme="link[href *= 'calendar-system']"/>
  
  <!-- Add in the Plone-created CSS, KSS and JS in addition to the static ones -->
  <drop theme="link[href *= 'plonebase']"/>
  <prepend content="/html/head/style" theme="/html/head/link"/>
  <!-- drop public, columns, portlets, deprecated, navtree, invisibles, print, mobile -->
  <prepend content="link[href *= 'css']" theme="/html/head/link"/>

  <prepend content="link[href *= 'ploneKss']" theme="/html/head/link"/>
  <prepend content="link[rel *= 'kinetic-stylesheet']" theme="/html/head/link"/>
  <prepend content="/html/head/script" theme="/html/head/link"/>

  <append content="link[rel = 'author']" theme="children:/html/head"/>
  <append content="link[rel = 'home']" theme="children:/html/head"/>
  <append content="link[rel = 'contents']" theme="children:/html/head"/>
  <append content="link[rel = 'search']" theme="children:/html/head"/>

  <!-- theme element droppings -->
  <drop theme="children:#navigation"/>
  <drop theme="children:#portal-breadcrumbs"/>
  <drop theme="#content-main h1"/>
  <drop theme="#content-main div.documentDescription"/>
  <drop theme="children:#column-1"/>
  <drop theme="children:#column-2"/>

  <replace content="attributes(class,dir):/html/body" theme="attributes:/html/body"/>

  <!-- Accessibility -->
  <prepend content="#portal-header > p.hiddenStructure" theme="children:body"/>

  <!-- Set correct Link for the logo -->
  <replace content="attributes:#portal-logo" theme="attributes:#logo a"/>

  <!-- Search box -->
  <drop content="#portal-searchbox div.searchSection"/>
  <drop content="tag:.LSBox"/>
  <replace content="children:#portal-searchbox" theme="children:#searchbox"/>

  <!-- metamenu -->
  <replace content="children:#portal-languageselector" theme="children:#lang"/>
  <replace content="#portal-siteactions" theme="#portal-siteactions"/>

  <!--navigation -->
  <append
      content="children:#portal-column-two dl.portletNavigationTree ul.navTreeLevel0"
      theme="children:#navigation"/>
  <drop content="#portal-column-two dl.portletNavigationTree"/>

  <append content="children:#portal-breadcrumbs" theme="children:#portal-breadcrumbs"/>

  <!-- teaser on startpage -->
  <drop theme="children:#teaser-main"/>
  <drop if-content="not:#portal-column-one dl.portletTeaser"
      theme="#teaser-main"/>
  <append
      content="children:#portal-column-one dl.portletTeaser dd"
      theme="children:#content-main #teaser-main" />
  <drop content="#portal-column-one dl.portletTeaser"/>
 
  <!-- Portlets -->
  <drop content="tag:div[id *= 'portletwrapper']"/>
  <drop content="span.portletTopLeft"/>
  <drop content="span.portletTopRight"/>
  <replace content="children:#portal-column-one" theme="children:#column-1"/>
  <replace content="children:#portal-column-two" theme="children:#column-2"/>

</rule>

<rule class="plone">

  <!-- main content -->
  <append content="attributes(class):div.documentEditable" theme="attributes(class):#content-main" />

  <append content=".portalMessage" theme="children:#content-main" />
  <append content="#content h1" theme="children:#content-main" />
  <append content="#plone-document-byline" theme="children:#content-main" />
  <append content="#edit-bar" theme="children:#content-main" />
  <append content="#content" theme="children:#content-main" />
</rule>

</ruleset>
